---
import BaseLayout from "../layouts/BaseLayout.astro";
import {
  people,
  missionVision,
  aboutPage,
  partnershipsPage,
} from "../data/content";
import OptimizedImage from "../layouts/utilities/OptimizedImage.astro";
import { Image, getImage } from "astro:assets";
import landscapeImage from "../assets/images/GeoPark Famenne Ardenne - landschap Hoge Venen (4).jpg";
import stefaniePortrait from "../assets/images/Stefanie Deleu - SOLA Travel - profiel.JPG";
import stefanieSolaPortrait from "../assets/images/Stefanie Deleu x SOLA TRAVEL.jpg";

const coreTeam = people.filter((person) => person.isTeamMember === true);
const partners = people.filter((person) => person.isTeamMember === false);
const linkClass = "text-accent-700 hover:text-accent-800";
const linkedLabel = aboutPage.label.replace(
  "reizen",
  `<a href="/reizen" class="${linkClass}">reizen</a>`,
);

// Optimize images for mission/vision sections
const optimizedLandscape = await getImage({
  src: landscapeImage,
  width: 1600,
  quality: 90,
});
const optimizedMissionPortrait = await getImage({
  src: stefanieSolaPortrait,
  width: 1200,
  quality: 90,
});
---

<BaseLayout title={aboutPage.title} description={aboutPage.metaDescription}>
  <section class="bg-base-50/80 border-b border-base-200">
    <div class="max-w-6xl mx-auto px-6 py-16 space-y-6 scroll-fade-in">
      <p
        class="uppercase text-xs tracking-[0.25em] text-base-500"
        set:html={linkedLabel}
      />
      <h1 class="text-4xl font-semibold text-base-900">{aboutPage.heading}</h1>
      <div
        class="text-base-700 max-w-3xl space-y-4"
        set:html={aboutPage.description}
      />
      <p class="text-base-700 max-w-2xl italic">{aboutPage.quote}</p>
    </div>
  </section>

  <section class="max-w-6xl mx-auto px-6 py-14 space-y-16">
    <!-- Missie & Visie -->
    <div class="space-y-8 lg:space-y-16 scroll-fade-in">
      <!-- Mission Section -->
      <div class="flex flex-col lg:flex-row gap-10 items-center scroll-fade-in">
        <div class="flex-1 space-y-3 lg:pr-8">
          <h3 class="text-2xl lg:text-3xl font-semibold text-base-900">
            {aboutPage.missieLabel}
          </h3>
          <div class="space-y-2">
            {
              missionVision.missionAccordion.map((item, index) => (
                <div
                  class={`border-t border-base-200 ${
                    index === missionVision.missionAccordion.length - 1
                      ? "border-b"
                      : ""
                  }`}
                >
                  <button
                    type="button"
                    class="w-full flex items-center justify-between gap-4 px-2 py-4 text-left text-base-900 font-semibold focus:outline-none focus-visible:ring-2 focus-visible:ring-accent-500/50 transition hover:text-base-800 hover:bg-base-900/3"
                    aria-expanded={index === 0 ? "true" : "false"}
                    aria-controls={`mission-panel-${index}`}
                    id={`mission-trigger-${index}`}
                    data-accordion-trigger="mission"
                  >
                    <span>{item.title}</span>
                    <span
                      class="ml-auto text-base-500 transition-colors duration-300"
                      aria-hidden="true"
                    >
                      +
                    </span>
                  </button>
                  <div
                    id={`mission-panel-${index}`}
                    class={`accordion-panel text-base-700 leading-relaxed px-2 ${
                      index === 0 ? "pb-3 open" : "pb-0"
                    }`}
                    role="region"
                    aria-labelledby={`mission-trigger-${index}`}
                    data-accordion-panel="mission"
                  >
                    <div class="space-y-3 pt-0.5">
                      {item.body.split("\n\n").map((paragraph) => (
                        paragraph === "— Stefanie" ? (
                          <p class="text-sm text-base-600 mt-2">{paragraph}</p>
                        ) : (
                          <p>{paragraph}</p>
                        )
                      ))}
                    </div>
                  </div>
                </div>
              ))
            }
          </div>
        </div>
        <div class="flex-1 lg:pl-8">
          <figure class="portrait-image-frame">
            <img
              src={optimizedMissionPortrait.src}
              width={optimizedMissionPortrait.width}
              height={optimizedMissionPortrait.height}
              alt="Stefanie Deleu, oprichtster van SOLA"
              class="portrait-image"
              loading="lazy"
              decoding="async"
            />
            <figcaption class="portrait-overlay">
              <span class="portrait-name">Stefanie Deleu</span>
              <span class="portrait-role">Oprichter · SOLA Travel</span>
            </figcaption>
          </figure>
        </div>
      </div>

      <!-- Vision Section -->
      <div class="flex flex-col lg:flex-row-reverse gap-12 items-center scroll-fade-in bg-base-50/50 rounded-3xl p-8 lg:p-12">
        <div class="flex-1 space-y-4 lg:pl-8">
          <h3 class="text-2xl lg:text-3xl font-semibold text-base-900">
            {aboutPage.visieLabel}
          </h3>
          <div
            class="text-lg text-base-700 leading-relaxed space-y-4"
            set:html={missionVision.visionHtml}
          />
        </div>
        <div class="flex-1 lg:pr-8">
          <div class="skewed-image-frame">
            <img
              class="skewed-image-inner"
              src={optimizedLandscape.src}
              width={optimizedLandscape.width}
              height={optimizedLandscape.height}
              alt="Landschap Hoge Venen - GeoPark Famenne Ardenne"
              loading="lazy"
              decoding="async"
            />
          </div>
        </div>
      </div>
    </div>

    <!-- Team -->
    <div class="space-y-8 scroll-fade-in">
      <div>
        <h2 class="text-3xl font-semibold text-base-900">
          {aboutPage.sectionTeam}
        </h2>
        <p class="text-base-700 mt-2 max-w-2xl">
          Het team dat SOLA draagt en vormgeeft.
        </p>
      </div>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {
          coreTeam.map((person) => (
            <article class="group p-6 rounded-2xl border-[0.25rem] border-white bg-white hover:shadow-lg hover:bg-accent-50/30 hover:border-accent-200 transition-all duration-300">
              <div class="flex items-start gap-4 mb-4">
                {person.logo ? (
                  <div class="w-24 h-24 rounded-full overflow-hidden shrink-0 bg-base-200">
                    {person.name === "Stefanie Deleu" ? (
                      <Image
                        src={stefaniePortrait}
                        alt={person.name}
                        class="w-full h-full object-cover"
                      />
                    ) : (
                      <OptimizedImage
                        src={person.logo}
                        alt={`${person.name}`}
                        width={400}
                        height={400}
                        quality={100}
                        class="w-full h-full object-cover"
                      />
                    )}
                  </div>
                ) : (
                  <div class="w-24 h-24 rounded-full shrink-0 bg-base-300 flex items-center justify-center">
                    <span class="text-2xl font-semibold text-base-600">
                      {person.name.charAt(0)}
                    </span>
                  </div>
                )}
                <div class="flex-1 min-w-0">
                  <h3 class="text-xl font-semibold text-base-900 mb-1">
                    {person.name}
                  </h3>
                  <p class="text-base-600">{person.role}</p>
                </div>
              </div>
              <p class="text-base-700 leading-relaxed">{person.bio}</p>
            </article>
          ))
        }
      </div>
    </div>

    <!-- Partners -->
    <div class="space-y-8 scroll-fade-in">
      <div>
        <h2 class="text-3xl font-semibold text-base-900">
          {partnershipsPage.sectionPartners}
        </h2>
        <p class="text-base-700 mt-2 max-w-2xl">
          Experts en specialisten met wie we samenwerken om de beste ervaringen te creëren.
        </p>
      </div>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {
          partners.map((partner) => (
            <article class="group p-6 rounded-2xl border-[0.25rem] border-white bg-white hover:shadow-lg hover:bg-accent-50/30 hover:border-accent-200 transition-all duration-300">
              <div class="flex items-start gap-4 mb-4">
                {partner.logo ? (
                  <div class="w-24 h-24 rounded-full overflow-hidden shrink-0 bg-base-200">
                    <OptimizedImage
                      src={partner.logo}
                      alt={`${partner.name}`}
                      width={400}
                      height={400}
                      quality={100}
                      class="w-full h-full object-cover"
                    />
                  </div>
                ) : (
                  <div class="w-24 h-24 rounded-full shrink-0 bg-base-300 flex items-center justify-center">
                    <span class="text-2xl font-semibold text-base-600">
                      {partner.name.charAt(0)}
                    </span>
                  </div>
                )}
                <div class="flex-1 min-w-0">
                  <h3 class="text-xl font-semibold text-base-900 mb-1">
                    {partner.name}
                  </h3>
                  <p class="text-base-600">{partner.role}</p>
                </div>
              </div>
              <p class="text-base-700 leading-relaxed mb-4">{partner.bio}</p>
              {partner.website && (
                <a
                  href={partner.website}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="inline-flex items-center text-sm font-semibold text-accent-700 hover:text-accent-800 transition-colors"
                >
                  {partner.name}
                  <svg
                    class="w-4 h-4 ml-1"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                    />
                  </svg>
                </a>
              )}
            </article>
          ))
        }
      </div>
    </div>

  </section>

  <!-- Partner CTA -->
  <section class="w-full bg-accent-600 text-white scroll-fade-in">
    <div class="max-w-6xl mx-auto px-6 py-8 lg:py-10 text-center space-y-6">
      <h2 class="text-2xl font-semibold">
        {partnershipsPage.ctaTitle}
      </h2>
      <p class="text-white/90 max-w-3xl mx-auto">
        {partnershipsPage.ctaDescription}
      </p>
      <a
        href="/contact"
        class="inline-flex items-center justify-center px-5 py-3 rounded-full bg-base-25 text-base-900 font-semibold"
      >
        Neem contact op
      </a>
    </div>
  </section>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const accordions = document.querySelectorAll(
        '[data-accordion-trigger="mission"]',
      );

      const closePanel = (button) => {
        const panelId = button.getAttribute("aria-controls");
        const panel = document.getElementById(panelId);
        const icon = button.querySelector("span[aria-hidden='true']");
        if (!panel || !icon) return;
        button.setAttribute("aria-expanded", "false");
        panel.style.maxHeight = "0px";
        panel.classList.remove("open");
        panel.classList.remove("pb-3");
        panel.classList.add("pb-0");
        icon.textContent = "+";
      };

      const openPanel = (button) => {
        const panelId = button.getAttribute("aria-controls");
        const panel = document.getElementById(panelId);
        const icon = button.querySelector("span[aria-hidden='true']");
        if (!panel || !icon) return;
        button.setAttribute("aria-expanded", "true");
        panel.classList.add("open");
        panel.classList.remove("pb-0");
        panel.classList.add("pb-3");
        panel.style.maxHeight = `${panel.scrollHeight}px`;
        icon.textContent = "–";
      };

      const togglePanel = (button) => {
        const isExpanded = button.getAttribute("aria-expanded") === "true";
        accordions.forEach((item) => closePanel(item));
        if (!isExpanded) {
          openPanel(button);
        }
      };

      accordions.forEach((button) => {
        button.addEventListener("click", () => togglePanel(button));
        button.addEventListener("keydown", (event) => {
          if (event.key === "Enter" || event.key === " ") {
            event.preventDefault();
            togglePanel(button);
          }
        });
      });

      accordions.forEach((button) => {
        if (button.getAttribute("aria-expanded") === "true") {
          openPanel(button);
        }
      });
    });
  </script>

  <style>
    .accordion-panel {
      max-height: 0;
      overflow: hidden;
      transition:
        max-height 0.3s ease,
        opacity 0.3s ease,
        padding 0.3s ease;
      opacity: 0;
    }

    .accordion-panel.open {
      opacity: 1;
    }
  </style>

  <style>
    .scroll-fade-in {
      opacity: 0;
      transform: translateY(30px);
      transition:
        opacity 0.8s ease-out,
        transform 0.8s ease-out;
    }

    .scroll-fade-in.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .skewed-image-frame {
      position: relative;
      padding: 0.25rem;
      background: linear-gradient(135deg, #f6f4f0 0%, #d6d2c8 100%);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
      overflow: hidden;
      border-radius: 1rem;
    }

    .skewed-image-inner {
      width: 100%;
      aspect-ratio: 16 / 9;
      object-fit: cover;
      object-position: center;
      display: block;
      margin: 0;
      border-radius: 0.75rem;
    }

    .portrait-image-frame {
      position: relative;
      overflow: hidden;
      border-radius: 0;
    }

    .portrait-image {
      width: 100%;
      height: 100%;
      max-height: 520px;
      aspect-ratio: 3 / 4;
      object-fit: cover;
      object-position: center;
      display: block;
      border-radius: 0;
    }

    .portrait-overlay {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
      padding: 2.5rem 1.25rem 1rem;
      font-size: 0.875rem;
      color: #f5f3ef;
      text-align: left;
    }

    .portrait-overlay::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(
        to top,
        rgba(19, 17, 14, 0.55),
        rgba(19, 17, 14, 0)
      );
      z-index: 0;
    }

    .portrait-overlay span {
      position: relative;
      z-index: 1;
    }

    .portrait-name {
      font-weight: 500;
    }

    .portrait-role {
      font-weight: 300;
      color: rgba(245, 243, 239, 0.85);
    }

    @media (max-width: 1024px) {
      .portrait-image {
        max-height: 420px;
      }

      .portrait-overlay {
        padding: 2rem 1rem 0.9rem;
      }
    }
  </style>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const observerOptions = {
        threshold: 0.1,
        rootMargin: "0px 0px -50px 0px",
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add("visible");
            // Stop observing once visible
            observer.unobserve(entry.target);
          }
        });
      }, observerOptions);

      // Use requestAnimationFrame to ensure DOM is fully rendered
      requestAnimationFrame(() => {
        document.querySelectorAll(".scroll-fade-in").forEach((el) => {
          // Check if element is already in view on page load
          const rect = el.getBoundingClientRect();
          const isInView = rect.top < window.innerHeight && rect.bottom > 0;
          
          if (isInView) {
            // Trigger animation for elements already in view
            setTimeout(() => {
              el.classList.add("visible");
            }, 200);
          }
          
          // Always observe for scroll-triggered animations
          observer.observe(el);
        });
      });
    });
  </script>
</BaseLayout>
