---
import BaseLayout from "../../layouts/BaseLayout.astro";
import type { Journey } from "../../data/content";
import { journeys } from "../../data/content";
import { marked } from "marked";
import { getImage } from "astro:assets";
import terraImage from "../../assets/images/1513986998.jpg";

export async function getStaticPaths() {
  const trips = journeys.filter((journey) => journey.type === "Reis");
  return Promise.all(
    trips.map(async (trip) => {
      let imageUrl = trip.heroImage;
      // If it's a local image path, process it
      if (trip.heroImage?.startsWith("/src/assets/images/")) {
        if (trip.slug === "solatravel-terra-frankrijk") {
          const optimized = await getImage({
            src: terraImage,
            width: 1400,
            quality: 85,
          });
          imageUrl = optimized.src;
        }
      }
      return {
        params: { slug: trip.slug },
        props: { trip: { ...trip, heroImage: imageUrl } },
      };
    })
  );
}

const { trip } = Astro.props as { trip: Journey };

// Render markdown to HTML
const markdownContent = trip.longread || "";
const htmlContent = markdownContent ? marked.parse(markdownContent) : "";
---

<BaseLayout
  title={`SOLATRAVEL | ${trip.name}`}
  description={trip.shortDescription}
>
  <section class="relative bg-base-900 text-white">
    <div
      class="absolute inset-0 opacity-45"
      style={{
        backgroundImage: `url(${trip.heroImage})`,
        backgroundSize: "cover",
        backgroundPosition: "center",
      }}
    >
    </div>
    <div class="relative max-w-6xl mx-auto px-6 py-24 space-y-6">
      <p class="uppercase text-xs tracking-[0.25em] text-white/70">
        {trip.type}
      </p>
      <h1 class="text-4xl lg:text-5xl font-semibold">{trip.name}</h1>
      <div class="flex flex-wrap gap-3 text-sm">
        <span class="px-3 py-1 rounded-full bg-white/15 border border-white/30"
          >{trip.location}</span
        >
        <span class="px-3 py-1 rounded-full bg-white/15 border border-white/30"
          >{trip.dates}</span
        >
        <span class="px-3 py-1 rounded-full bg-white/15 border border-white/30"
          >{trip.price}</span
        >
      </div>
      <div class="flex flex-wrap gap-3">
        <a
          href="#content"
          class="inline-flex items-center px-5 py-3 rounded-full bg-white text-base-900 font-semibold"
          >Lees meer</a
        >
        <a
          href="/contact"
          class="inline-flex items-center px-5 py-3 rounded-full border border-white/60 text-white font-semibold"
          >Plan een gesprek</a
        >
      </div>
    </div>
  </section>

  {
    htmlContent && (
      <section id="content" class="max-w-4xl mx-auto px-6 py-14">
        <div
          class="prose prose-lg prose-base-900 max-w-none
          prose-headings:font-semibold prose-headings:text-base-900
          prose-h2:text-2xl prose-h2:mt-12 prose-h2:mb-6
          prose-h3:text-xl prose-h3:mt-8 prose-h3:mb-4
          prose-p:text-base-700 prose-p:leading-relaxed prose-p:mb-4
          prose-ul:text-base-700 prose-ul:my-4
          prose-li:my-2
          prose-strong:text-base-900 prose-strong:font-semibold
          prose-a:text-accent-600 prose-a:no-underline hover:prose-a:underline"
          set:html={htmlContent}
        />
      </section>
    )
  }
</BaseLayout>
