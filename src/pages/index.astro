---
import BaseLayout from "../layouts/BaseLayout.astro";
import { homeCopy, journeys, people, homePage } from "../data/content";
import { getImage } from "astro:assets";
import heroImage from "../assets/images/hero.jpg";
import exerciseImage from "../assets/images/2596052607.jpg";
import bewustwordingImage from "../assets/images/2631991747.jpg";
import terraImage from "../assets/images/1513986998.jpg";
import hauteLoireImage from "../assets/images/haute-loire.jpg";

const weekendHighlights = journeys
  .filter((journey) => journey.type === "Weekend")
  .slice(0, 2);
const founders = people.filter((person) => person.isTeamMember);

// Get optimized hero image URL for background use
const optimizedHero = await getImage({
  src: heroImage,
  width: 1920,
  quality: 85,
});

// Process hero images for weekend highlights
const weekendHighlightsWithImages = await Promise.all(
  weekendHighlights.map(async (weekend) => {
    let imageUrl = weekend.heroImage;
    // If it's a local image path, process it
    if (weekend.heroImage?.startsWith("/src/assets/images/")) {
      if (weekend.slug === "exercise-is-medicine") {
        const optimized = await getImage({
          src: exerciseImage,
          width: 1600,
          quality: 90,
        });
        imageUrl = optimized.src;
      } else if (weekend.slug === "bewustwording-connectie") {
        const optimized = await getImage({
          src: bewustwordingImage,
          width: 1600,
          quality: 90,
        });
        imageUrl = optimized.src;
      }
    }
    return { ...weekend, heroImage: imageUrl };
  }),
);

// Process images for pillars
const pillarsWithImages = await Promise.all(
  homeCopy.pillars.map(async (pillar, index) => {
    if (!pillar.image) return { ...pillar, imageUrl: null };

    let imageSrc;
    if (pillar.image === "/src/assets/images/2596052607.jpg") {
      imageSrc = exerciseImage;
    } else if (pillar.image === "/src/assets/images/2631991747.jpg") {
      imageSrc = bewustwordingImage;
    } else if (pillar.image === "/src/assets/images/hero.jpg") {
      imageSrc = heroImage;
    } else if (pillar.image === "/src/assets/images/1513986998.jpg") {
      imageSrc = terraImage;
    } else {
      return { ...pillar, imageUrl: null };
    }

    // Vary image sizes for visual interest
    const widths = [1200, 1400, 1000, 1600, 1100];
    const optimized = await getImage({
      src: imageSrc,
      width: widths[index % widths.length],
      quality: 90,
    });

    return { ...pillar, imageUrl: optimized.src };
  }),
);

// Optimize haute-loire image for founder section
const optimizedHauteLoire = await getImage({
  src: hauteLoireImage,
  width: 1200,
  quality: 90,
});
---

<BaseLayout
  title={homePage.title}
  description={homePage.description}
>
  <section
    class="relative overflow-hidden min-h-screen sm:min-h-[700px] lg:min-h-[850px] hero-bg-animated"
    style={`background-image: url(${optimizedHero.src});`}
  >
    <div
      class="absolute inset-0 bg-stone/90"
    >
    </div>
    <div
      class="relative max-w-6xl mx-auto px-6 py-20 lg:py-28 grid lg:grid-cols-2 gap-12 items-center min-h-screen sm:min-h-[700px] lg:min-h-[850px]"
    >
      <div class="space-y-6">
        <p class="uppercase text-xs tracking-[0.25em] text-ebony/80">
          {homePage.brandLabel}
        </p>
        <h1 class="text-4xl lg:text-5xl font-semibold leading-tight text-ebony">
          {homeCopy.tagline}
        </h1>
        <p class="text-lg text-ebony/85 max-w-xl">{homeCopy.waarom}</p>
        <div class="flex flex-wrap gap-3">
          <a
            href="/reizen"
            class="btn-primary"
          >
            {homePage.ctaDiscover}
          </a>
          <a
            href="/contact"
            class="btn-secondary"
          >
            {homePage.ctaContact}
          </a>
        </div>
      </div>
    </div>
  </section>

  <section class="max-w-6xl mx-auto px-6 pt-8 lg:pt-14 pb-0">
    <h2 class="text-3xl lg:text-4xl font-semibold text-ebony text-center">
      Hoe we werken
    </h2>
  </section>

  <section class="max-w-6xl mx-auto px-6 pt-2 lg:pt-4 pb-8 lg:pb-14 space-y-10 scroll-fade-in">
    <div class="space-y-8 lg:space-y-16 py-4 lg:py-8">
      <div class="space-y-8 lg:space-y-12">
        {
          pillarsWithImages.map((pillar, index) => {
            const isEven = index % 2 === 0;
            const hasBackground = index % 2 === 1;
            return (
              <div
                class={`flex flex-col lg:flex-row gap-12 items-center scroll-fade-in ${
                  isEven ? "lg:flex-row" : "lg:flex-row-reverse"
                } ${hasBackground ? "bg-white rounded-3xl p-8 lg:p-12 border border-ebony/10 shadow-sm" : ""}`}
                style={`animation-delay: ${index * 0.2}s;`}
              >
                <div
                  class={`flex-1 space-y-4 ${isEven ? "lg:pr-8" : "lg:pl-8"}`}
                >
                  <h4 class="text-2xl lg:text-3xl font-semibold text-ebony">
                    {pillar.title}
                  </h4>
                  <p class="text-lg text-ebony/85 leading-relaxed">
                    {pillar.description}
                  </p>
                </div>
                {pillar.imageUrl && (
                  <div class={`flex-1 ${isEven ? "lg:pl-8" : "lg:pr-8"}`}>
                    <div class="skewed-image-frame">
                      <div
                        class="skewed-image-inner"
                        style={`background-image: url(${pillar.imageUrl});`}
                      />
                    </div>
                  </div>
                )}
              </div>
            );
          })
        }
      </div>
    </div>

    <style>
      .hero-bg-animated {
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        animation: subtleMove 20s ease-in-out infinite alternate;
      }

      @keyframes subtleMove {
        0% {
          background-position: center center;
          background-size: cover;
        }
        100% {
          background-position: 55% 45%;
          background-size: cover;
        }
      }

      .skewed-image-frame {
        position: relative;
        padding: 0.25rem;
        background: var(--sola-white);
        border: 1px solid color-mix(in srgb, var(--sola-ebony) 12%, transparent);
        box-shadow: 0 15px 40px color-mix(in srgb, var(--sola-ebony) 20%, transparent);
        overflow: hidden;
        border-radius: 1rem;
      }

      .skewed-image-inner {
        width: 100%;
        aspect-ratio: 16 / 9;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        display: block;
        margin: 0;
        border-radius: 0.75rem;
      }

      .scroll-fade-in {
        opacity: 0;
        transform: translateY(30px);
        transition:
          opacity 0.8s ease-out,
          transform 0.8s ease-out;
      }

      .scroll-fade-in.visible {
        opacity: 1;
        transform: translateY(0);
      }
    </style>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const observerOptions = {
          threshold: 0.1,
          rootMargin: "0px 0px -50px 0px",
        };

        const observer = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add("visible");
            }
          });
        }, observerOptions);

        document.querySelectorAll(".scroll-fade-in").forEach((el) => {
          observer.observe(el);
        });
      });
    </script>
  </section>

  <section class="bg-stone border-y border-ebony/10 scroll-fade-in">
    <div class="max-w-6xl mx-auto px-6 py-8 lg:py-14 space-y-8">
      <div class="flex items-end justify-between gap-4">
        <div>
          <p class="uppercase text-xs tracking-[0.25em] text-ebony/80">
            {homePage.sectionAanbod.label}
          </p>
          <h3 class="text-3xl font-semibold text-ebony">
            {homePage.sectionAanbod.title}
          </h3>
          <p class="text-ebony/85">{homePage.sectionAanbod.description}</p>
        </div>
        <a class="text-sm font-semibold link-default" href="/reizen"
          >{homePage.sectionAanbod.link}</a
        >
      </div>
      <div class="grid md:grid-cols-2 gap-6">
        {
          weekendHighlightsWithImages.map((weekend) => (
            <a
              href={`/weekenden/${weekend.slug}`}
              class="rounded-3xl border border-ebony/10 overflow-hidden bg-white shadow-sm hover:shadow-lg transition flex flex-col group cursor-pointer"
            >
              <div
                class="relative aspect-video bg-stone overflow-hidden"
                style={{
                  backgroundImage: `url(${weekend.heroImage})`,
                  backgroundSize: "cover",
                  backgroundPosition: "center",
                }}
              >
                <div class="absolute inset-0 bg-ebony/0 group-hover:bg-ebony/40 transition-all duration-300 flex items-center justify-center">
                  <span class="opacity-0 group-hover:opacity-100 transition-opacity duration-300 inline-flex items-center px-5 py-3 rounded-full bg-white text-ebony font-semibold">
                    {homePage.ctaDiscoverWeekend}
                  </span>
                </div>
              </div>
              <div class="p-6 space-y-3 flex-1 flex flex-col">
                <div class="flex items-center gap-3 text-xs uppercase tracking-wide text-ebony/80">
                  <span class="px-3 py-1 rounded-full bg-stone border border-ebony/10">
                    {weekend.location}
                  </span>
                  <span class="text-ebony/80">{weekend.dates}</span>
                </div>
                <h4 class="text-xl font-semibold text-ebony">
                  {weekend.name}
                </h4>
                <p class="text-ebony/85">{weekend.shortDescription}</p>
                <div class="mt-auto flex items-center justify-between text-sm font-semibold text-ebony pt-2">
                  <span class="text-ebony">{weekend.price}</span>
                  <span class="text-terracotta group-hover:underline">
                    {homePage.ctaDiscoverWeekend}
                  </span>
                </div>
              </div>
            </a>
          ))
        }
      </div>
    </div>
  </section>

  <section class="max-w-6xl mx-auto px-6 py-8 lg:py-14 space-y-8 scroll-fade-in">
    <div class="flex flex-col lg:flex-row gap-12 items-center">
      <div class="flex-1 space-y-4 lg:pr-8">
        <p class="uppercase text-xs tracking-[0.25em] text-ebony/80">
          {homePage.sectionOverOns.label}
        </p>
        <h3 class="text-3xl font-semibold text-ebony">
          {homePage.sectionOverOns.title}
        </h3>
        <p class="text-ebony/85">
          {homePage.sectionOverOns.description}
        </p>
        <a
          class="btn-secondary w-fit"
          href="/over-ons"
        >
          {homePage.sectionOverOns.cta}
        </a>
      </div>
      <div class="flex-1 lg:pl-8">
        <div class="skewed-image-frame">
          <div
            class="skewed-image-inner"
            style={`background-image: url(${optimizedHauteLoire.src});`}
          />
        </div>
      </div>
    </div>
  </section>

  <section class="bg-stone border-y border-ebony/10 py-10 lg:py-16 scroll-fade-in">
    <div class="max-w-4xl mx-auto px-6 text-center">
      <div class="rounded-3xl border border-ebony/10 bg-white shadow-sm px-6 py-10 space-y-6">
        <h3 class="text-3xl font-semibold text-ebony">
          {homeCopy.afsluiting.title}
        </h3>
        <div class="flex flex-wrap justify-center gap-3">
          <a class="btn-primary" href="/reizen">{homeCopy.afsluiting.primary}</a>
          <a class="btn-secondary" href="/contact">{homeCopy.afsluiting.secondary}</a>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
